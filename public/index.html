<html>

<head>
  <title>Express</title>
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>

<body>
  <h1>Express</h1>
  <p>Welcome to Express</p>
  <table id="playfield"> 
  </table>

  <br/>

  <table id="buttons">
    <tr> <td          >    </td> <td id="up"  >^</td> <td           >    </td> </tr>
    <tr> <td id="left">&lt;</td> <td id="down">v</td> <td id="right">&gt;</td> </tr>
  </table>

  <script>
    function inRange(begin, end, value) {
      return begin <= value && value < end
    }

    function makeRow(width, contents) {
      var tr = document.createElement("tr")

      for (var cell = 0; cell < width; cell++)  {
        td = document.createElement("td")
        td.innerText = contents
        tr.appendChild(td)
      }
      
      return tr
    }

    class Playfield {
      constructor(doc, width, height) {
        this.element = doc.getElementsByTagName("table")[0]
        this.grass = '.'
        this.resize(width, height)
      }

      resize(width, height)  {
        this.width   = width
        this.height  = height

        this.element.innerHTML = ''

        for (var row = 0; row < height; row++) {
          this.element.appendChild(makeRow(width, this.grass))
        }
      }

      draw(x, y, str) {
        if (inRange(0, this.width, x) && inRange(0, this.height, y)) {
          this.element.rows[y].cells[x].innerText = str
        }
      }

      erase(x, y) {
        this.draw(x, y, this.grass)
      }
    }

    class Player {
      constructor(playfield) {
        this.x =
        this.y = 0
        this.playfield = playfield
      }

      draw() {
        this.playfield.draw(this.x, this.y, "@")
      }

      erase() {
        this.playfield.erase(this.x, this.y)
      }

      move(dx, dy) {
        this.erase()

        this.x += dx
        this.y += dy

        this.draw()
      }

      buttonClicked(direction) {
        ({
          up    : () => { this.move( 0, -1) },
          left  : () => { this.move(-1,  0) },
          down  : () => { this.move( 0,  1) },
          right : () => { this.move( 1,  0) }
        })[direction]()
      }
    }

    playfield = new Playfield(document, 10, 10)
    playerOne = new Player(playfield)
    playerOne.move(4, 4)
    var button

    for (var action of ["up", "left", "down", "right"]) {
      if (button = document.getElementById(action)) {
        button.setAttribute('onclick', "playerOne.buttonClicked(\""+action+"\")")
      } else {
        console.warn("Input button not found: " + action)
      }
    }

  </script>
</body>

</html>
